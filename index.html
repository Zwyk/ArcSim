<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ARC Raiders — TTK Simulator</title>
  <link rel="icon" type="image/png" href="Rubber_Duck.png" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="titleRow">
          <div class="title">ARC Raiders</div>
          <button id="infoBtn" class="ghost iconBtn" type="button" title="Information">i</button>
        </div>
        <div class="subtitle">TTK Simulator</div>
      </div>

      <div class="panel">
        <label class="label">Preset</label>
        <select id="presetSelect"></select>

        <label class="label">Target</label>
        <select id="targetSelect"></select>

        <label class="label">Tiers</label>
        <div id="tierChecks" class="tierChecks"></div>

        <label class="check">
          <input id="baseOnly" type="checkbox" checked />
          Base only (no attachments)
        </label>

        <label class="check">
          <input id="stackEq" type="checkbox" checked />
          Stack equivalent results (same TTK)
        </label>

        <label class="label">Stack tolerance (seconds)</label>
        <input id="stackTol" type="number" min="0" step="0.000001" value="0.000001" />
      </div>

      <div class="panel">
        <div class="panelTitle">Custom preset (simulated)</div>

        <!-- Removed custom enable checkbox; custom simulation always available -->

        <div class="row2">
          <div>
            <label class="label">Head %</label>
            <input id="headPct" type="range" min="0" max="100" value="10" />
          </div>
          <div>
            <label class="label">Limbs %</label>
            <input id="limbsPct" type="range" min="0" max="100" value="20" />
          </div>
        </div>
        <div class="hint" id="bodyLabel">Body: 70%, Head: 10%, Limbs: 20%</div>

        <label class="label">Miss %</label>
        <input id="missPct" type="range" min="0" max="95" value="5" />
        <div class="hint" id="missLabel">Miss: 5%</div>

        <div class="row2">
          <div>
            <label class="label">Trials</label>
            <input id="trials" type="number" min="100" step="100" value="5000" />
          </div>
          <div>
            <label class="label">Seed</label>
            <input id="seed" type="number" min="0" step="1" value="1337" />
          </div>
        </div>

        <label class="label">Confidence level</label>
        <select id="confidence">
          <option value="0.90">90%</option>
          <option value="0.95" selected>95%</option>
          <option value="0.99">99%</option>
        </select>

        <button id="runBtn">Start simulation</button>
        <div style="display:flex; align-items:center; gap:8px; margin-top:8px;">
          <button id="editWeaponsBtn" class="ghost" type="button">Edit weapons.json</button>
          <span id="weaponsOverrideCue" class="hint" style="display:none;">Override active</span>
        </div>
        <div class="hint" id="status"></div>

        <button id="downloadBtn" class="ghost" disabled>Download current rows (.json)</button>
      </div>
    </aside>

    <main class="main">
      <div class="header">
        <div>
          <div class="h1" id="heading">Fastest setups</div>
          <div class="hint" id="subheading"></div>
        </div>
        <div class="stats">
          <div class="stat"><div class="k" id="rowsCount">0</div><div class="v">rows</div></div>
          <div class="stat"><div class="k" id="weaponsCount">0</div><div class="v">weapons</div></div>
        </div>
      </div>

      <div class="tableWrap">
        <div class="chartGlobalControls">
          <label class="chartCtl">
            <span>Metric</span>
            <select id="graphMetric">
              <option value="ttk">TTK</option>
              <option value="shots">Shots</option>
              <option value="fire_time">Fire time</option>
              <option value="reloads">Reloads</option>
              <option value="reload_time">Reload time</option>
            </select>
          </label>
        </div>
        <div class="card chartCard">
          <div class="chartHeader">
            <div class="chartTitle">Weapons graph</div>
            <div class="chartMeta" id="chartMeta"></div>
          </div>

          <div class="chartWrap">
            <canvas id="ttkChart"></canvas>
            <div id="chartTooltip" class="chartTooltip" style="display:none;"></div>
          </div>
        </div>

        <div class="card chartCard" id="compareCard" style="display:none;">
          <div class="chartHeader">
            <div>
              <div class="chartTitle">Weapon comparison</div>
              <div class="chartMeta" id="compareMeta"></div>
            </div>

            <div class="chartControls">
              <label class="chartCtl">
                <span>Weapon</span>
                <select id="compareWeapon"></select>
              </label>

              <label class="chartCtl">
                <span>Compare by</span>
                <select id="compareMode">
                  <option value="tier">Tier</option>
                  <option value="attachments">Attachments</option>
                </select>
              </label>

              <label class="chartCtl" id="compareTierCtl" style="display:none;">
                <span>Tier</span>
                <select id="compareTier"></select>
              </label>
            </div>
          </div>

          <div class="chartWrap">
            <canvas id="compareChart"></canvas>
            <div id="compareTooltip" class="chartTooltip" style="display:none;"></div>
          </div>
        </div>

        <label class="chartCtl">
          <span>Table values</span>
          <select id="tableCenter">
            <option value="mean" selected>Mean</option>
            <option value="median">Median</option>
          </select>
        </label>

        <table>
          <thead>
            <tr>
              <th class="sortable" data-sort="weapon">weapon</th>
              <th class="sortable num" data-sort="tier">tier</th>
              <th class="sortable" data-sort="attachments">attachments</th>
              <th class="sortable num" data-sort="ttk">ttk</th>
              <th class="sortable num" data-sort="shots">shots</th>
              <th class="sortable num" data-sort="fire_time">fire time</th>
              <th class="sortable num" data-sort="reloads">reloads</th>
              <th class="sortable num" data-sort="reload_time">reload time</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </main>
  </div>

  <div id="modal" class="modal hidden">
    <div class="modalBox">
      <div class="modalTitle">Variants</div>
      <div id="modalBody" class="modalBody"></div>
      <button id="modalClose" class="ghost">Close</button>
    </div>
  </div>

  <!-- Info modal -->
  <div id="infoModal" class="modal hidden" style="display:none;">
    <div class="modalBox">
      <div class="modalTitle">Information</div>
      <div class="modalBody">
Simulations are done assuming each gun shoots 1 bullet at a time, at steady rate, and at optimal distance. That means:
  - For guns that do shoot more than 1 bullet a time (like shotguns), we cumulate their damage and assume they all hit the same part.
  - For guns that shoot semi-automatically, we assume maximum firing rate.
  - For guns that shoot in burst or need to charge, we assume an average firing rate.

Aim/ADS time are not accounted for.

Some weapons stats may be inaccurate. I'll update them according to the most reliable information I find.

If you think the weapons stats are wrong or just want to mess around, you can see and edit them by pressing the button down there.
If you're SURE about some weapon stats that are wrong by default and want me to fix them, hit me on Discord: Zwyk
      </div>
      <div style="margin-top:12px; display:flex; justify-content:flex-end;">
        <button id="closeInfoModal" class="ghost" type="button">Close</button>
      </div>
    </div>
  </div>

  <!-- Weapons editor modal -->
  <div id="weaponsModal" class="modal hidden" style="display:none;">
    <div class="modalBox" style="max-width: 980px; width: 96%; padding: 18px;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <div>
          <div style="font-size:16px; font-weight:650;">Custom weapons.json (session only)</div>
          <div style="font-size:12px; opacity:.75;">Used only for custom simulations. Refreshing the page resets unless you export/import.</div>
        </div>
        <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
          <button id="validateWeaponsBtn" class="btn secondary" type="button">Validate</button>
          <button id="saveWeaponsBtn" class="btn" type="button">Save override</button>
          <button id="closeWeaponsModal" class="btn secondary" type="button">Close</button>
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
        <button id="loadWeaponsDefault" class="btn secondary" type="button">Load from data/weapons.json</button>
        <button id="resetWeaponsOverride" class="btn secondary" type="button">Reset override</button>
        <button id="downloadWeaponsOverride" class="btn secondary" type="button">Download JSON</button>
        <input id="importWeaponsOverride" type="file" accept="application/json" style="display:none;">
        <button id="importWeaponsBtn" class="btn secondary" type="button">Import JSON…</button>
        <div id="weaponsModalStatus" style="font-size:12px; opacity:.8; margin-left:auto;"></div>
      </div>

      <textarea id="weaponsEditor"
        spellcheck="false"
        style="margin-top:12px; width:100%; height:60vh; resize:vertical; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:12px; line-height:1.4; background:rgba(0,0,0,.25); color:inherit; border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:12px;"></textarea>

      
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
